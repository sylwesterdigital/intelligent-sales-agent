<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Sales Machine</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --bg: #050816;
      --bg-soft: #0b1020;
      --bg-softer: #111827;
      --accent: #22c55e;
      --accent-soft: rgba(34,197,94,0.12);
      --accent-strong: #4ade80;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: #1f2933;
      --danger: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top left, #1e293b 0, var(--bg) 40%);
      color: var(--text-main);
    }

    .page {
      max-width: 1160px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      font-size: 13px;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .brand span {
      color: var(--accent);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--accent-strong);
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(34,197,94,0.8);
    }

    .flash-banner {
      padding: 10px 14px;
      border-radius: 10px;
      background: #064e3b;
      color: #dcfce7;
      border: 1px solid #22c55e;
      font-size: 13px;
      margin-bottom: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .flash-banner span {
      opacity: 0.9;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.2fr);
      gap: 18px;
      margin-bottom: 28px;
    }

    .card {
      background: linear-gradient(135deg, #020617 0%, #020617 55%, #020617 100%);
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 18px 18px 16px;
    }

    .card h1, .card h2, .card h3 {
      margin: 0;
    }

    .hero-title {
      font-size: 26px;
      line-height: 1.2;
      margin-bottom: 6px;
    }

    .hero-title span.accent-blue {
      background: linear-gradient(90deg, #22c55e, #22d3ee, #818cf8);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-sub {
      font-size: 13px;
      color: var(--text-muted);
      max-width: 460px;
      margin-bottom: 18px;
    }

    /* ICP FORM */
    .icp-form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px 12px;
      margin-bottom: 14px;
    }

    .icp-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .icp-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .icp-input, .icp-textarea {
      border-radius: 10px;
      border: 1px solid #111827;
      background: #020617;
      padding: 7px 9px;
      font-size: 13px;
      color: var(--text-main);
    }

    .icp-input:focus, .icp-textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.3);
    }

    .icp-textarea {
      min-height: 72px;
      resize: vertical;
    }

    .size-group {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .size-group .icp-input {
      text-align: left;
    }

    .lead-limit-input {
      max-width: 100px;
    }

    .run-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }

    .run-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .btn-primary {
      appearance: none;
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      background: radial-gradient(circle at top left, #22c55e 0, #15803d 40%, #16a34a 100%);
      color: #022c22;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 18px rgba(34,197,94,0.45);
    }

    .btn-primary span.dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #bbf7d0;
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(34,197,94,0.3);
    }

    .btn-primary[disabled] {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    /* PIPELINE STATUS */
    .pipeline-status-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
    }

    .pipeline-status-title {
      font-size: 14px;
      font-weight: 600;
    }

    .pill-live {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      border: 1px solid rgba(34,197,94,0.6);
    }

    .pipeline-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 14px;
    }

    .pipeline-pill {
      background: var(--bg-softer);
      border-radius: 12px;
      padding: 10px 10px 9px;
      border: 1px solid #111827;
      font-size: 11px;
    }

    .pipeline-pill-title {
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      font-size: 10px;
      margin-bottom: 3px;
    }

    .pipeline-pill-body {
      font-size: 11px;
      color: #e5e7eb;
    }

    .video-cta {
      margin-top: 6px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px dashed #374151;
      background: #020617;
      font-size: 11px;
      color: var(--text-muted);
    }

    .video-cta strong {
      color: #e5e7eb;
    }

    /* QUALIFIED LEADS TABLE */
    .leads-card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
    }

    .leads-title {
      font-size: 14px;
      font-weight: 600;
    }

    .leads-count {
      font-size: 11px;
      color: var(--text-muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 7px 9px;
      border-bottom: 1px solid #111827;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    tbody tr:hover {
      background: #020617;
    }

    td a {
      color: var(--accent-strong);
      text-decoration: none;
    }

    td a:hover {
      text-decoration: underline;
    }

    .score-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(34,197,94,0.12);
      border: 1px solid rgba(34,197,94,0.5);
      font-size: 11px;
      color: var(--accent-strong);
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(59,130,246,0.1);
      border: 1px solid rgba(59,130,246,0.6);
      color: #bfdbfe;
      font-size: 11px;
    }

    .channels-pill {
      display: inline-flex;
      gap: 5px;
    }

    .channel {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 11px;
      color: var(--text-muted);
    }

    .footer {
      margin-top: 10px;
      font-size: 10px;
      color: var(--text-muted);
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .icp-form-grid {
        grid-template-columns: minmax(0, 1fr);
      }

      th, td {
        padding: 6px 6px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="top-bar">
      <div class="brand">AI <span>Sales Machine</span></div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>GREEN BOXES = it works</span>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="flash-banner">
      <span>{{ message }}</span>
      <span>✓</span>
    </div>
    {% endfor %}
    {% elif latest_run %}
    <div class="flash-banner">
      <span>{{ latest_run.status_message }}</span>
      <span>✓</span>
    </div>
    {% endif %}
    {% endwith %}

    <div class="layout">
      <!-- LEFT COLUMN: HERO + ICP FORM -->
      <div class="card">
        <h1 class="hero-title">
          Build an <span class="accent-blue">AI Sales Engine</span> that runs on autopilot
        </h1>
        <p class="hero-sub">
          Scrape, enrich, qualify, and send hyper-personalized multi-channel outreach to ideal customers from a single control panel.
        </p>




        <!-- ICP FORM -->
        <!-- ICP FORM -->
        <form method="post" action="{{ url_for('index') }}">

          <div class="icp-form-grid">
            <div class="icp-field">
              <label class="icp-label">Job title</label>
              <input class="icp-input" type="text" name="job_title"
              value="{{ latest_run.job_title if latest_run else 'CEO' }}">
            </div>

            <div class="icp-field">
              <label class="icp-label">Company</label>
              <input class="icp-input" type="text" name="company_type"
              value="{{ latest_run.company_type if latest_run else 'Digital Marketing Agency' }}">
            </div>

            <div class="icp-field">
              <label class="icp-label">Location</label>
              <input class="icp-input" type="text" name="location"
              value="{{ latest_run.location if latest_run else 'New York' }}">
            </div>

            <div class="icp-field">
              <label class="icp-label">Industry</label>
              <input class="icp-input" type="text" name="industry"
              value="{{ latest_run.industry if latest_run else 'Marketing' }}">
            </div>

            <div class="icp-field">
              <label class="icp-label">Size (min / max)</label>
              <div class="size-group">
                <input class="icp-input" type="number" name="size_min"
                value="{{ latest_run.size_min if latest_run else 1 }}">
                <input class="icp-input" type="number" name="size_max"
                value="{{ latest_run.size_max if latest_run else 50 }}">
              </div>
            </div>

            <div class="icp-field">
              <label class="icp-label">Lead limit (per run)</label>
              <input class="icp-input lead-limit-input" type="number" min="1" max="1000" name="lead_limit"
              value="{{ latest_run.lead_limit if latest_run else 10 }}">
            </div>
          </div>

          <div class="icp-field">
            <label class="icp-label">Your value proposition</label>
            <textarea class="icp-textarea" name="value_proposition" rows="3">{% if latest_run and latest_run.value_prop %}
            {{ latest_run.value_prop }}{% else %}We build AI-powered outbound machines that create a consistent flow of qualified demos for agencies.{% endif %}</textarea>
          </div>

          <div class="run-row">
            <div class="run-meta">
              {% if latest_run %}
              Last run: {{ latest_run.completed_at.strftime('%Y-%m-%d %H:%M') if latest_run.completed_at else latest_run.created_at.strftime('%Y-%m-%d %H:%M') }}
              {% else %}
              No runs yet. Configure your ICP and launch the first pipeline.
              {% endif %}
            </div>
            <button type="submit" class="btn-primary">
              <span class="dot"></span>
              <span>Run AI Sales Machine</span>
            </button>
          </div>
        </form>






      </div>

      <!-- RIGHT COLUMN: PIPELINE STATUS -->
      <div class="card">
        <!-- PIPELINE STATUS -->
        <div class="pipeline-status-header">
          <div class="pipeline-status-title">Pipeline status</div>
          <div class="pill-live">LIVE</div>
        </div>

        <div class="pipeline-grid">
          <div class="pipeline-pill">
            <div class="pipeline-pill-title">Scrape &amp; Enrich</div>
            <div class="pipeline-pill-body">
              Leads sourced &amp; enriched from Apollo / Google Search APIs.
            </div>
          </div>
          <div class="pipeline-pill">
            <div class="pipeline-pill-title">Qualify</div>
            <div class="pipeline-pill-body">
              AI scores prospects 0–10 based on ICP fit and website.
            </div>
          </div>
          <div class="pipeline-pill">
            <div class="pipeline-pill-title">Sequencing</div>
            <div class="pipeline-pill-body">
              Multi-step LinkedIn + email sequences generated automatically.
            </div>
          </div>
          <div class="pipeline-pill">
            <div class="pipeline-pill-title">Reply Detection</div>
            <div class="pipeline-pill-body">
              Smart reply detection pauses sequences when prospects engage.
            </div>
          </div>
        </div>

        <div class="video-cta">
          <strong>Want the full breakdown video?</strong><br>
          Comment “SALES” on the LinkedIn post or trigger an automation here to send it via email / DM.<br>
          <span>Coming soon: one-click “Send video to warm leads”.</span>
        </div>
      </div>
    </div>






    <!-- QUALIFIED LEADS TABLE -->
    <div class="card">
      <div class="leads-card-header">
        <div class="leads-title">Qualified leads</div>
        <div class="leads-count">
          {% if leads %}
          {{ leads|length }} leads in current run
          {% else %}
          No leads yet – run the pipeline to generate prospects.
          {% endif %}
        </div>
      </div>

      {% if leads %}
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Lead</th>
              <th>Company</th>
              <th>Location</th>
              <th>Email</th>
              <th>Score</th>
              <th>Status</th>
              <th>Channels</th>
            </tr>
          </thead>
          <tbody>
            {% for lead in leads %}
            <tr>
              <td>
                {{ lead.lead_name }}<br>
                <span style="font-size:11px;color:var(--text-muted);">
                  {{ lead.lead_title }}
                </span><br>
                <span style="font-size:11px;">
                  {% if lead.company_website %}
                  <a href="{{ lead.company_website }}" target="_blank">Website</a>
                  {% endif %}
                  {% if lead.company_website and lead.linkedin_url %} · {% endif %}
                  {% if lead.linkedin_url %}
                  <a href="{{ lead.linkedin_url }}" target="_blank">LinkedIn</a>
                  {% endif %}
                </span>
              </td>
              <td>{{ lead.company_name }}</td>
              <td>{{ lead.location }}</td>
              <td>
                {% if lead.work_email %}
                <a href="mailto:{{ lead.work_email }}">{{ lead.work_email }}</a>
                {% endif %}
              </td>
              <td>
                <span class="score-pill">
                  <span>{{ "%.1f"|format(lead.score or 0) }}/10</span>
                </span>
              </td>
              <td>
                <span class="status-pill">{{ lead.status or 'MESSAGED' }}</span>
              </td>
              <td>
                <span class="channels-pill">
                  {% if lead.channel_email_enabled %}
                  <span class="channel">Email</span>
                  {% endif %}
                  {% if lead.channel_linkedin_enabled %}
                  <span class="channel">LinkedIn</span>
                  {% endif %}
                </span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      <div class="footer">
        PS. “GREEN BOXES = it works” — mirror N8N workflow states here as real integrations are added.
      </div>
    </div>





  </div>
</div>
</body>
</html>
